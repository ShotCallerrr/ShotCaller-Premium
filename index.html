<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Crop Yield — Prototype</title>
  <style>
    :root{
      --accent:#4f46e5;
      --accent2:#06b6d4;
      --muted:#666;
      --card:#fff;
      --bg:linear-gradient(135deg,#f0f9ff,#e0f2fe,#f5f3ff);
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);}
    .container{max-width:1150px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:46px;height:46px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;box-shadow:0 3px 10px rgba(0,0,0,0.2)}
    h1{margin:0;font-size:20px;color:#111}
    .card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 8px 20px rgba(20,30,50,0.08);transition:transform 0.2s}
    .card:hover{transform:translateY(-2px)}
    .grid{display:grid;grid-template-columns:280px 1fr;gap:18px;margin-top:18px}
    nav .menu{display:flex;flex-direction:column;gap:10px}
    .menu button{background:none;border:0;padding:12px 14px;border-radius:10px;text-align:left;cursor:pointer;font-weight:500;transition:all 0.2s}
    .menu button:hover{background:rgba(79,70,229,0.08)}
    .menu button.active{background:linear-gradient(90deg,rgba(79,70,229,0.15),rgba(6,182,212,0.12));color:var(--accent)}
    .login-wrap{max-width:420px;margin:40px auto}
    .form-row{margin-bottom:14px}
    label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e3e6ef;background:#fff;font-size:14px}
    textarea{resize:vertical;min-height:60px}
    .btn{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;transition:opacity 0.2s}
    .btn:hover{opacity:0.9}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(79,70,229,0.3)}
    .small{font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f0f2f6;text-align:left;font-size:14px}
    .kpi{display:flex;gap:14px}
    .kpi .item{flex:1;padding:14px;border-radius:12px;background:linear-gradient(135deg,#fff,#f8fafc);box-shadow:0 4px 12px rgba(20,30,50,0.06)}
    footer{margin-top:28px;text-align:center;color:var(--muted);font-size:13px}
    /* Discussion */
    .post{padding:12px;border-bottom:1px solid #eee}
    .post strong{color:#111}
    .reply{margin-left:20px;padding:6px 0;font-size:13px;color:#444}
    .postForm textarea{margin-bottom:8px}
    .post img,.reply img{max-width:200px;display:block;margin-top:6px;border-radius:8px}
    @media(max-width:880px){.grid{grid-template-columns:1fr;}.logo{display:none}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">AI</div>
        <div>
          <h1>AI Crop Yield — Prototype</h1>
          <div class="small">Prediction • Recommendations • Discussion</div>
        </div>
      </div>
    </header>

    <div id="app">
      <!-- Login -->
      <div id="authView" class="login-wrap card">
        <h2 id="authTitle">Sign in</h2>
        <div class="form-row"><label>Email / Phone</label><input id="email"></div>
        <div class="form-row"><label>Password</label><input id="password" type="password"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="authBtn">Sign in</button>
          <button class="btn ghost" id="toggleAuth">Create account</button>
        </div>
        <div class="note small">Prototype only. Data stored in browser localStorage.</div>
      </div>

      <!-- Main -->
      <div id="mainView" style="display:none">
        <div class="grid">
          <nav>
            <div class="card">
              <div class="menu">
                <button class="active" data-view="dashboard">Dashboard</button>
                <button data-view="discussion">Discussion</button>
                <button id="logoutBtn" class="btn ghost">Logout</button>
              </div>
            </div>
          </nav>
          <main>
            <section id="dashboard" class="card view">
              <h3>Dashboard</h3>
              <div class="kpi" style="margin-top:12px">
                <div class="item"><div class="small">Predicted avg yield</div><div style="font-size:22px;font-weight:700" id="kpiYield">-- kg/ha</div></div>
                <div class="item"><div class="small">Soil health</div><div style="font-size:22px;font-weight:700" id="kpiSoil">--</div></div>
              </div>
            </section>
            <section id="discussion" class="card view" style="display:none">
              <h3>Community Discussion</h3>
              <div class="postForm">
                <textarea id="postText" placeholder="Share your problem or tip..."></textarea>
                <input type="file" id="postImage" accept="image/*">
                <button class="btn" id="addPost">Post</button>
              </div>
              <div id="postsList" style="margin-top:12px"></div>
            </section>
          </main>
        </div>
        <footer>Prototype — Local storage only. Replace with backend + ML API for production.</footer>
      </div>
    </div>
  </div>

  <script>
    const $=id=>document.getElementById(id);
    const LS_USER='acrop_user',LS_USERS='acrop_users',LS_POSTS='acrop_posts';
    function getCurrentUser(){return JSON.parse(localStorage.getItem(LS_USER)||'null')}
    function login(e,p){let u={email:e,password:p,name:e.split('@')[0]};localStorage.setItem(LS_USER,JSON.stringify(u));return u}
    function logout(){localStorage.removeItem(LS_USER);renderApp()}
    function getPosts(){return JSON.parse(localStorage.getItem(LS_POSTS)||'[]')}
    function savePosts(p){localStorage.setItem(LS_POSTS,JSON.stringify(p))}
    function addPost(){
      let txt=$('postText').value.trim();if(!txt)return;
      let file=$('postImage').files[0];if(file){
        let r=new FileReader();
        r.onload=()=>{saveNewPost(txt,r.result);};
        r.readAsDataURL(file);
      } else saveNewPost(txt,null);
    }
    function saveNewPost(txt,img){
      let posts=getPosts();
      posts.unshift({id:Date.now(),author:getCurrentUser().name,text:txt,img:img,time:new Date().toLocaleString(),replies:[]});
      savePosts(posts);$('postText').value='';$('postImage').value='';renderPosts();
    }
    function renderPosts(){
      let list=$('postsList'),posts=getPosts();
      if(!posts.length){list.innerHTML='<p class="small">No posts yet</p>';return}
      list.innerHTML='';
      posts.forEach(p=>{
        let div=document.createElement('div');div.className='post';
        div.innerHTML=`<strong>${p.author}</strong> <span class="small">${p.time}</span><br>${p.text}`;
        if(p.img)div.innerHTML+=`<img src="${p.img}">`;
        div.innerHTML+=`<div class="small" style="margin-top:4px"><input placeholder="Reply..." data-id="${p.id}"><input type="file" data-img="${p.id}" accept="image/*"><button class="btn ghost" data-reply="${p.id}">Reply</button></div>`;
        p.replies.forEach(r=>{div.innerHTML+=`<div class="reply"><strong>${r.author}</strong>: ${r.text}${r.img?`<img src="${r.img}">`:''}</div>`});
        list.appendChild(div);
      });
      list.querySelectorAll('button[data-reply]').forEach(b=>{
        b.onclick=()=>{
          let id=b.dataset.reply;
          let inp=list.querySelector(`input[data-id="${id}"]`);
          let f=list.querySelector(`input[data-img="${id}"]`).files[0];
          let txt=inp.value.trim();
          if(!txt && !f)return;
          if(f){
            let r=new FileReader();
            r.onload=()=>saveReply(id,txt,r.result);
            r.readAsDataURL(f);
          } else saveReply(id,txt,null);
        };
      });
    }
    function saveReply(id,txt,img){
      let posts=getPosts();
      let post=posts.find(x=>x.id==id);
      post.replies.push({author:getCurrentUser().name,text:txt,img:img});
      savePosts(posts);renderPosts();
    }
    function renderApp(){
      const u=getCurrentUser();
      if(!u){$('authView').style.display='block';$('mainView').style.display='none';$('authBtn').onclick=()=>{login($('email').value,$('password').value);renderApp()};return}
      $('authView').style.display='none';$('mainView').style.display='block';
      document.querySelectorAll('.menu button').forEach(b=>b.onclick=ev=>{
        document.querySelectorAll('.menu button').forEach(x=>x.classList.remove('active'));
        ev.currentTarget.classList.add('active');
        document.querySelectorAll('.view').forEach(v=>v.style.display='none');
        $(ev.currentTarget.dataset.view).style.display='block';
      });
      $('logoutBtn').onclick=()=>logout();
      $('addPost').onclick=addPost;
      renderPosts();
    }
    renderApp();
  </script>
</body>
</html>
